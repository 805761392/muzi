{extend name='public/base2' /}
{block name='content'}
<div class="main-body">
    <style>
.order-item {
    border: 1px solid transparent;
    margin-bottom: 1rem;
}

.order-item table {
    margin: 0;
}

.order-item:hover {
    border: 1px solid #3c8ee5;
}

.goods-item {
    margin-bottom: .75rem;
}

.goods-item:last-child {
    margin-bottom: 0;
}

.goods-pic {
    width: 5.5rem;
    height: 5.5rem;
    display: inline-block;
    background-color: #ddd;
    background-size: cover;
    background-position: center;
    margin-right: 1rem;
}

.goods-name {
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
}

.order-tab-1 {
    width: 40%;
}

.order-tab-2 {
    width: 20%;
    text-align: center;
}

.order-tab-3 {
    width: 10%;
    text-align: center;
}

.order-tab-4 {
    width: 20%;
    text-align: center;
}

.order-tab-5 {
    width: 10%;
    text-align: center;
}

.status-item.active {
    color: inherit;
}
</style>
<script language="JavaScript" src="Scripts/lodopfuncs.js"></script>
<object id="LODOP_OB" classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA" width=0 height=0 style="display: none">
<embed id="LODOP_EM" type="application/x-print-lodop" width=0 height=0></embed>
</object>

<div class="panel mb-3">
<div class="panel-header">订单管理</div>
<div class="panel-body">
    <div class="mb-3 clearfix">
        <div class="p-4 bg-shaixuan">
            <form method="get">
                                                            <input type="hidden" name="r" value="mch/miaosha/order/offline">
                                    <div flex="dir:left">
                    <div class="mr-4">
                        <div class="form-group row w-20">
                            <div class="col-5">
                                <select class="form-control" name="keyword_1">
                                    <option value="1" >订单号</option>
                                    <option value="2" >用户</option>
                                    <option value="3" >收货人</option>
                                </select>
                            </div>
                            <div class="col-7">
                                <input class="form-control"
                                       name="keyword"
                                       autocomplete="off"
                                       value="">
                            </div>
                        </div>
                    </div>
                    <div class="mr-4">
                        <div class="form-group row">
                            <div>
                                <label>下单时间：</label>
                            </div>
                            <div>
                                <div class="input-group">
                                    <input class="form-control" id="date_start" name="date_start"
                                           autocomplete="off"
                                           value="">
                                    <span class="input-group-btn">
                                        <a class="btn btn-secondary" id="show_date_start" href="javascript:">
                                            <span class="iconfont icon-daterange"></span>
                                        </a>
                                    </span>
                                    <span class="middle-center" style="padding:0 4px">至</span>
                                    <input class="form-control" id="date_end" name="date_end"
                                           autocomplete="off"
                                           value="">
                                    <span class="input-group-btn">
                                        <a class="btn btn-secondary" id="show_date_end" href="javascript:">
                                            <span class="iconfont icon-daterange"></span>
                                        </a>
                                    </span>
                                </div>
                            </div>
                            <div class="middle-center">
                                <a href="javascript:" class="new-day" data-index="7">近7天</a>
                                <a href="javascript:" class="new-day" data-index="30">近30天</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div flex="dir:left">
                    <div class="mr-4">
                        <div class="form-group">
                            <button class="btn btn-primary mr-4">筛选</button>
                            <a class="btn btn-secondary"
                               href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline&flag=EXPORT">批量导出</a>
                        </div>
                    </div>
                </div>
                <div flex="dir:left">
                    <div class="mr-4">
                                                                                                        </div>
                </div>
            </form>
        </div>
    </div>
    <div class="mb-4">
        <ul class="nav nav-tabs status">
            <li class="nav-item">
                <a class="status-item nav-link active"
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline">全部</a>
            </li>
            <li class="nav-item">
                <a class="status-item nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline&status=0">未付款</a>

            </li>
            <li class="nav-item">
                <a class="status-item nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline&status=1">待发货</a>
            </li>
            <li class="nav-item">
                <a class="status-item  nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline&status=2">待收货</a>
            </li>
            <li class="nav-item">
                <a class="status-item  nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline&status=3">已完成</a>
            </li>
            <li class="nav-item">
                <a class="status-item  nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline&status=6">待处理</a>
            </li>
            <li class="nav-item">
                <a class="status-item  nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline&status=5">已取消</a>
            </li>
            <li class="nav-item">
                <a class="status-item  nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Foffline&status=7">异常订单</a>
            </li>
        </ul>
    </div>
    <table class="table table-bordered bg-white">
        <tr>
            <th class="order-tab-1">商品信息</th>
            <th class="order-tab-2">金额</th>
            <th class="order-tab-3">实际付款</th>
            <th class="order-tab-4">订单状态</th>
            <th class="order-tab-5">操作</th>
        </tr>
    </table>
            <div class="text-center">
                    <div class="text-muted">0条数据</div>
    </div>

    <!-- 发货 -->
    <div class="modal fade send-modal" data-backdrop="static">
        <div class="modal-dialog modal-sm" role="document" style="max-width: 400px">
            <div class="modal-content">
                <div class="modal-header">
                    <b class="modal-title">物流信息</b>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="send-form" method="post">
                        <div class="form-group row">
                            <div class="col-3 text-right">
                                <label class=" col-form-label">物流选择</label>
                            </div>
                            <div class="col-9">
                                <div class="pt-1">
                                    <label class="custom-control custom-radio">
                                        <input id="radio1" value="1" checked
                                               name="is_express" type="radio"
                                               class="custom-control-input is-express">
                                        <span class="custom-control-indicator"></span>
                                        <span class="custom-control-description">快递</span>
                                    </label>
                                    <label class="custom-control custom-radio">
                                        <input id="radio2" value="0" name="is_express" type="radio"
                                               class="custom-control-input is-express">
                                        <span class="custom-control-indicator"></span>
                                        <span class="custom-control-description">无需物流</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="is-true-express">
                            <input class="form-control" type="hidden" autocomplete="off" name="order_id">
                            <label>快递公司</label>
                            <div class="input-group mb-3">
                                <input class="form-control" placeholder="请输入快递公司" type="text" autocomplete="off"
                                       name="express">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-secondary dropdown-toggle"
                                            data-toggle="dropdown"
                                            aria-haspopup="true" aria-expanded="false">
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right"
                                         style="max-height: 250px;overflow: auto">
                                                                                                                                    <a class="dropdown-item" href="javascript:">顺丰快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">申通快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">韵达快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">圆通速递</a>
                                                                                        <a class="dropdown-item" href="javascript:">中通速递</a>
                                                                                        <a class="dropdown-item" href="javascript:">百世快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">EMS</a>
                                                                                        <a class="dropdown-item" href="javascript:">天天快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">邮政平邮/小包</a>
                                                                                        <a class="dropdown-item" href="javascript:">宅急送</a>
                                                                                        <a class="dropdown-item" href="javascript:">国通快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">全峰快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">优速快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">中铁快运</a>
                                                                                        <a class="dropdown-item" href="javascript:">中铁物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">亚马逊物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">城际快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">德邦</a>
                                                                                        <a class="dropdown-item" href="javascript:">汇丰物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">百世快运</a>
                                                                                        <a class="dropdown-item" href="javascript:">安捷快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">安能物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">安信达快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">北青小红帽</a>
                                                                                        <a class="dropdown-item" href="javascript:">百福东方</a>
                                                                                        <a class="dropdown-item" href="javascript:">CCES快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">城市100</a>
                                                                                        <a class="dropdown-item" href="javascript:">COE东方快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">长沙创一</a>
                                                                                        <a class="dropdown-item" href="javascript:">成都善途速运</a>
                                                                                        <a class="dropdown-item" href="javascript:">D速物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">大田物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">快捷速递</a>
                                                                                        <a class="dropdown-item" href="javascript:">FEDEX联邦(国内件）</a>
                                                                                        <a class="dropdown-item" href="javascript:">FEDEX联邦(国际件）</a>
                                                                                        <a class="dropdown-item" href="javascript:">飞康达</a>
                                                                                        <a class="dropdown-item" href="javascript:">广东邮政</a>
                                                                                        <a class="dropdown-item" href="javascript:">共速达</a>
                                                                                        <a class="dropdown-item" href="javascript:">高铁速递</a>
                                                                                        <a class="dropdown-item" href="javascript:">恒路物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">天地华宇</a>
                                                                                        <a class="dropdown-item" href="javascript:">华强物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">华夏龙物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">好来运快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">京广速递</a>
                                                                                        <a class="dropdown-item" href="javascript:">九曳供应链</a>
                                                                                        <a class="dropdown-item" href="javascript:">佳吉快运</a>
                                                                                        <a class="dropdown-item" href="javascript:">嘉里物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">捷特快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">急先达</a>
                                                                                        <a class="dropdown-item" href="javascript:">晋越快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">加运美</a>
                                                                                        <a class="dropdown-item" href="javascript:">佳怡物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">跨越物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">龙邦快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">联昊通速递</a>
                                                                                        <a class="dropdown-item" href="javascript:">民航快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">明亮物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">能达速递</a>
                                                                                        <a class="dropdown-item" href="javascript:">平安达腾飞快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">全晨快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">全日通快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">如风达</a>
                                                                                        <a class="dropdown-item" href="javascript:">赛澳递</a>
                                                                                        <a class="dropdown-item" href="javascript:">圣安物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">盛邦物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">上大物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">盛丰物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">盛辉物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">速通物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">速腾快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">速尔快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">唐山申通</a>
                                                                                        <a class="dropdown-item" href="javascript:">全一快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">万家物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">万象物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">新邦物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">信丰快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">希优特</a>
                                                                                        <a class="dropdown-item" href="javascript:">新杰物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">源安达快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">远成物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">义达国际物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">越丰物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">原飞航物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">亚风快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">运通快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">亿翔快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">增益快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">汇强快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">众通快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">中邮物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">速必达物流</a>
                                                                                        <a class="dropdown-item" href="javascript:">瑞丰速递</a>
                                                                                        <a class="dropdown-item" href="javascript:">快客快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">CNPEX中邮快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">鸿桥供应链</a>
                                                                                        <a class="dropdown-item" href="javascript:">海派通物流公司</a>
                                                                                        <a class="dropdown-item" href="javascript:">澳邮专线</a>
                                                                                        <a class="dropdown-item" href="javascript:">泛捷快递</a>
                                                                                        <a class="dropdown-item" href="javascript:">PCA Express</a>
                                                                                        <a class="dropdown-item" href="javascript:">UEQ Express</a>
                                                                                </div>
                                </div>
                            </div>
                            <label>收件人邮编</label>
                            <input class="form-control" placeholder="请输入收件人邮编" type="text" autocomplete="off"
                                   name="post_code">
                            <label><a class="print" href="javascript:">打印面单</a></label>
                            <label><a href='http://www.c-lodop.com/download.html' target='_blank'>下载插件</a></label>
                            <div class="text-danger">需要设置面单打印功能</div>
                            <label>快递单号</label>
                            <input class="form-control" placeholder="请输入快递单号" type="text" autocomplete="off"
                                   name="express_no">
                            <div class="text-danger mt-3 form-error" style="display: none"></div>
                        </div>
                        <div class="mt-2">
                            <label>商家留言（选填）</label>
                            <textarea class="form-control" name="words"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary send-confirm-btn">提交</button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- 修改价格 -->
<div class="modal fade" data-backdrop="static" id="price">
<div class="modal-dialog modal-sm" role="document" style="max-width: 400px">
    <div class="modal-content">
        <div class="modal-header">
            <b class="modal-title">价格修改</b>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <input class="order-id" type="hidden">
            <div class="form-group row">
                <label class="col-4 text-right col-form-label">商品价格修改：</label>
                <div class="col-8">
                    <input class=" form-control money" type="number" placeholder="请填写增加或减少的价格">
                    <div class="fs-sm">注：商品价格修改，改的是订单中所有商品的总价格</div>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-4 text-right col-form-label">运费修改：</label>
                <div class="col-8">
                    <input class=" form-control update-express" type="number" placeholder="请填写增加或减少的价格">
                    <div class="fs-sm">注：运费修改，改的是订单中运费的价格</div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:" class="btn btn-primary add-price" data-type="1">加价</a>
            <a href="javascript:" class="btn btn-primary add-price" data-type="2">优惠</a>
        </div>
    </div>
</div>
</div>

<style>
.form-control {
    /*height: 34px;*/
}

.form-group > div:first-child {
    padding-right: 4px;
    text-align: right;
}

.form-group > div:last-child {
    padding-left: 4px;
}

.middle-center {
    /*line-height: 34px;*/
}

.w-20 {
    width: 20rem;
}

.w-12 {
    width: 12rem;
}

.status .nav-item,.bg-shaixuan {
    background-color: #f8f8f8;
}

.status .nav-item .nav-link {
    color: #464a4c;
    border: 1px solid #ddd;
    border-radius: 0;
}

.status .nav-item .nav-link.active {
    border-color: #ddd #ddd #fff;
    background-color: #fff;
}
</style>
<script>
jQuery.datetimepicker.setLocale('zh');
jQuery('#date_start').datetimepicker({
    datepicker: true,
    timepicker: false,
    format: 'Y-m-d',
    dayOfWeekStart: 1,
    scrollMonth: false,
    scrollTime: false,
    scrollInput: false,
    onShow: function (ct) {
        this.setOptions({
            maxDate: jQuery('#date_end').val() ? jQuery('#date_end').val() : false
        })
    }
});
$(document).on('click', '#show_date_start', function () {
    $('#date_start').datetimepicker('show');
});
jQuery('#date_end').datetimepicker({
    datepicker: true,
    timepicker: false,
    format: 'Y-m-d',
    dayOfWeekStart: 1,
    scrollMonth: false,
    scrollTime: false,
    scrollInput: false,
    onShow: function (ct) {
        this.setOptions({
            minDate: jQuery('#date_start').val() ? jQuery('#date_start').val() : false
        })
    }
});
$(document).on('click', '#show_date_end', function () {
    $('#date_end').datetimepicker('show');
});
$(document).on('click', '.new-day', function () {
    var index = $(this).data('index');
    var myDate = new Date();
    var mydate = new Date(myDate.getTime() - index * 24 * 60 * 60 * 1000);
    jQuery('#date_start').datetimepicker('setOptions', {value: mydate});
    jQuery('#date_end').datetimepicker('setOptions', {value: myDate});
});
</script>


<script>
$(document).on("click", ".apply-status-btn", function () {
    var url = $(this).attr("href");
    $.myConfirm({
        content: "确认“" + $(this).text() + "”？",
        confirm: function () {
            $.myLoading();
            $.ajax({
                url: url,
                dataType: "json",
                success: function (res) {
                    $.myLoadingHide();
                    $.myAlert({
                        content: res.msg,
                        confirm: function () {
                            if (res.code == 0)
                                location.reload();
                        }
                    });
                }
            });
        }
    });
    return false;
});


$(document).on("click", ".send-btn", function () {
    var order_id = $(this).attr("data-order-id");
    $(".send-modal input[name=order_id]").val(order_id);
    $(".send-modal").modal("show");
});
$(document).on("click", ".send-confirm-btn", function () {
    var btn = $(this);
    var error = $(".send-form").find(".form-error");
    btn.btnLoading("正在提交");
    error.hide();
    console.log(error);
    $.ajax({
        url: "/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Fsend",
        type: "post",
        data: $(".send-form").serialize(),
        dataType: "json",
        success: function (res) {
            if (res.code == 0) {
                btn.text(res.msg);
                location.reload();
                $(".send-modal").modal("hide");
            }
            if (res.code == 1) {
                btn.btnReset();
                error.html(res.msg).show();
            }
        }
    });
});


</script>
<!--打印函数-->
<script>
var LODOP; //声明为全局变量
//检测是否含有插件
function CheckIsInstall() {
    try {
        var LODOP = getLodop();
        if (LODOP.VERSION) {
            if (LODOP.CVERSION)
                $.myAlert({
                    content: "当前有C-Lodop云打印可用!\n C-Lodop版本:" + LODOP.CVERSION + "(内含Lodop" + LODOP.VERSION + ")"
                });
            else
                $.myAlert({
                    content: "本机已成功安装了Lodop控件！\n 版本号:" + LODOP.VERSION
                });

        }
    } catch (err) {
    }
}
;
//打印预览
function myPreview() {
    LODOP.PRINT_INIT("");
    LODOP.ADD_PRINT_HTM(10, 50, '100%', '100%', $('#print').html());
}
$(document).on('click', '.print', function () {
    var id = $(".send-modal input[name=order_id]").val();
    var express = $(".send-modal input[name=express]").val();
    var post_code = $(".send-modal input[name=post_code]").val();
    $.ajax({
        url: "http://wx.gxmuzi.com/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Fprint",
        type: 'get',
        dataType: 'json',
        data: {
            id: id,
            express: express,
            post_code: post_code
        },
        success: function (res) {
            if (res.code == 0) {
                LODOP.PRINT_INIT("");
                LODOP.ADD_PRINT_HTM(10, 50, '100%', '100%', res.data.PrintTemplate);
                LODOP.PRINT_DESIGN();
                $(".send-modal input[name=express_no]").val(res.data.Order.LogisticCode);
            } else {
                $.myAlert({
                    content: res.msg
                });
            }
        }
    });
});
</script>
<script>
$(document).on('click', '.update', function () {
    var order_id = $(this).data('id');
    $('.order-id').val(order_id);
});
$(document).on('click', '.add-price', function () {
    var btn = $(this);
    var order_id = $('.order-id').val();
    var price = $('.money').val();
    var update_express = $('.update-express').val();
    var type = btn.data('type');
    var error = $('.form-error');
    btn.btnLoading(btn.text());
    error.hide();
    $.ajax({
        url: "/addons/zjhj_mall/core/web/index.php?r=mch%2Fmiaosha%2Forder%2Fadd-price",
        type: 'get',
        dataType: 'json',
        data: {
            order_id: order_id,
            price: price,
            type: type,
            update_express: update_express
        },
        success: function (res) {
            if (res.code == 0) {
                window.location.reload();
            } else {
                error.html(res.msg).show()
            }
        },
        complete: function (res) {
            btn.btnReset();
        }
    });
});
$(document).on('click', '.is-express', function () {
    if ($(this).val() == 0) {
        $('.is-true-express').prop('hidden', true);
    } else {
        $('.is-true-express').prop('hidden', false);
    }
});
</script>    </div>
</div>
{/block}
