{extend name='public/base2' /}
{block name='content'}
<div class="main-body">
    <style>
.order-item {
    border: 1px solid transparent;
    margin-bottom: 1rem;
}

.order-item table {
    margin: 0;
}

.order-item:hover {
    border: 1px solid #3c8ee5;
}

.goods-item {
    margin-bottom: .75rem;
}

.goods-item:last-child {
    margin-bottom: 0;
}

.goods-pic {
    width: 5.5rem;
    height: 5.5rem;
    display: inline-block;
    background-color: #ddd;
    background-size: cover;
    background-position: center;
    margin-right: 1rem;
}

.goods-name {
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
}

.order-tab-1 {
    width: 40%;
}

.order-tab-2 {
    width: 30%;
}

.order-tab-3 {
    width: 20%;
    text-align: center;
}

.order-tab-4 {
    width: 10%;
    text-align: center;
}

.status-item.active {
    color: inherit;
}

.img-view-list {
    margin-left: -.5rem;
    margin-top: -.5rem;
}

.img-view {
    width: 4rem;
    height: 4rem;
    display: inline-block;
    background-size: cover;
    background-position: center;
    cursor: pointer;
    opacity: .85;
    margin-top: .5rem;
    margin-left: .5rem;
}

.img-view:hover {
    opacity: 1;
}

.img-view-box {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, .5);
    z-index: 1030;
    visibility: hidden;
    opacity: 0;
}

.img-view-box.active {
    visibility: visible;
    opacity: 1;
}

.img-view-close {
    position: absolute;
    right: 2rem;
    top: 2rem;
    display: inline-block;
    font-size: 3rem;
    color: #ddd !important;
    cursor: pointer;
    width: 3rem;
    height: 3rem;
    line-height: 3rem;
    text-align: center;
}

.img-view-close:hover {
    color: #fff !important;
    text-decoration: none;
}
</style>


<div class="panel mb-3" id="app">
<div class="panel-header">售后订单</div>
<div class="panel-body">
    <div class="mb-3 clearfix">
        <div class="p-4 bg-shaixuan">
            <form method="get">
                                                            <input type="hidden" name="r" value="mch/order/refund">

                <div flex="dir:left">
                    <div class="mr-4">
                        <div class="form-group row w-20">
                            <div class="col-5">
                                <select class="form-control" name="keyword_1">
                                    <option value="1" >订单号</option>
                                    <option value="2" >用户</option>
                                    <option value="3" >收货人</option>
                                </select>
                            </div>
                            <div class="col-7">
                                <input class="form-control"
                                       name="keyword"
                                       autocomplete="off"
                                       value="">
                            </div>
                        </div>
                    </div>
                    <div class="mr-4">
                        <div class="form-group row">
                            <div>
                                <label>下单时间：</label>
                            </div>
                            <div>
                                <div class="input-group">
                                    <input class="form-control" id="date_start" name="date_start"
                                           autocomplete="off"
                                           value="">
                                    <span class="input-group-btn">
                                        <a class="btn btn-secondary" id="show_date_start" href="javascript:">
                                            <span class="iconfont icon-daterange"></span>
                                        </a>
                                    </span>
                                    <span class="middle-center" style="padding:0 4px">至</span>
                                    <input class="form-control" id="date_end" name="date_end"
                                           autocomplete="off"
                                           value="">
                                    <span class="input-group-btn">
                                        <a class="btn btn-secondary" id="show_date_end" href="javascript:">
                                            <span class="iconfont icon-daterange"></span>
                                        </a>
                                    </span>
                                </div>
                            </div>
                            <div class="middle-center">
                                <a href="javascript:" class="new-day" data-index="7">近7天</a>
                                <a href="javascript:" class="new-day" data-index="30">近30天</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div flex="dir:left">
                    <div class="mr-4">
                        <div class="form-group">
                            <button class="btn btn-primary mr-4">筛选</button>
                            <a class="btn btn-secondary"
                               href="/addons/zjhj_mall/core/web/index.php?r=mch%2Forder%2Frefund&flag=EXPORT">批量导出</a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="mb-4">
        <ul class="nav nav-tabs status">
            <li class="nav-item">
                <a class="status-item nav-link active"
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Forder%2Frefund">全部</a>
            </li>
            <li class="nav-item">
                <a class="status-item nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Forder%2Frefund&status=0">待处理</a>
            </li>
            <li class="nav-item">
                <a class="status-item nav-link "
                   href="/addons/zjhj_mall/core/web/index.php?r=mch%2Forder%2Frefund&status=1">已处理</a>
            </li>
        </ul>
    </div>
    <table class="table table-bordered bg-white">
        <tr>
            <th class="order-tab-1">商品信息</th>
            <th class="order-tab-2">退款退货|换货</th>
            <th class="order-tab-3">状态</th>
            <th class="order-tab-4">操作</th>
        </tr>
    </table>
            <div class="text-center">
                    <div class="text-muted">0条数据</div>
    </div>
</div>
</div>


<div class="img-view-box" flex="cross:center main:center">
<a class="img-view-close" href="javascript:">×</a>
<img src="">
</div>


<style>
.form-control {
    /*height: 34px;*/
}

.form-group > div:first-child {
    padding-right: 4px;
    text-align: right;
}

.form-group > div:last-child {
    padding-left: 4px;
}

.middle-center {
    /*line-height: 34px;*/
}

.w-20 {
    width: 20rem;
}

.w-12 {
    width: 12rem;
}

.status .nav-item,.bg-shaixuan {
    background-color: #f8f8f8;
}

.status .nav-item .nav-link {
    color: #464a4c;
    border: 1px solid #ddd;
    border-radius: 0;
}

.status .nav-item .nav-link.active {
    border-color: #ddd #ddd #fff;
    background-color: #fff;
}
</style>
<script>
jQuery.datetimepicker.setLocale('zh');
jQuery('#date_start').datetimepicker({
    datepicker: true,
    timepicker: false,
    format: 'Y-m-d',
    dayOfWeekStart: 1,
    scrollMonth: false,
    scrollTime: false,
    scrollInput: false,
    onShow: function (ct) {
        this.setOptions({
            maxDate: jQuery('#date_end').val() ? jQuery('#date_end').val() : false
        })
    }
});
$(document).on('click', '#show_date_start', function () {
    $('#date_start').datetimepicker('show');
});
jQuery('#date_end').datetimepicker({
    datepicker: true,
    timepicker: false,
    format: 'Y-m-d',
    dayOfWeekStart: 1,
    scrollMonth: false,
    scrollTime: false,
    scrollInput: false,
    onShow: function (ct) {
        this.setOptions({
            minDate: jQuery('#date_start').val() ? jQuery('#date_start').val() : false
        })
    }
});
$(document).on('click', '#show_date_end', function () {
    $('#date_end').datetimepicker('show');
});
$(document).on('click', '.new-day', function () {
    var index = $(this).data('index');
    var myDate = new Date();
    var mydate = new Date(myDate.getTime() - index * 24 * 60 * 60 * 1000);
    jQuery('#date_start').datetimepicker('setOptions', {value: mydate});
    jQuery('#date_end').datetimepicker('setOptions', {value: myDate});
});
</script>

<script>

$(document).on("click", ".img-view", function () {
    var src = $(this).attr("data-src");
    $(".img-view-box").addClass("active").find("img").attr("src", src);
});

$(document).on("click", ".img-view-close", function () {
    $(".img-view-box").removeClass("active");
});


//同意退货退款
$(document).on("click", ".agree-btn-1", function () {
    var id = $(this).attr("data-id");
    var price = $(this).attr("data-price");
    $.myConfirm({
        content: "确认同意退货退款？<br>确认通过后退款金额<b class=text-danger>" + price + "元</b>将直接返还给用户！",
        confirm: function () {
            $.myLoading({
                title: "正在提交"
            });
            $.ajax({
                type: "post",
                data: {
                    _csrf: _csrf,
                    order_refund_id: id,
                    type: 1,
                    action: 1,
                },
                dataType: "json",
                success: function (res) {
                    if (res.code == 0) {
                        $.myAlert({
                            content: res.msg,
                            confirm: function () {
                                location.reload();
                            }
                        });
                    }
                    if (res.code == 1) {
                        $.myAlert({
                            content: res.msg,
                            confirm: function () {
                                $.myLoadingHide();
                            }
                        });
                    }
                }
            });

        }
    });
});

//拒绝退货退款
$(document).on("click", ".disagree-btn-1", function () {
    var id = $(this).attr("data-id");
    var price = $(this).attr("data-price");
    $.myConfirm({
        content: "确认拒绝该退货退款申请？",
        confirm: function () {
            $.myLoading({
                title: "正在提交"
            });
            $.ajax({
                type: "post",
                data: {
                    _csrf: _csrf,
                    order_refund_id: id,
                    type: 1,
                    action: 2,
                },
                dataType: "json",
                success: function (res) {
                    if (res.code == 0) {
                        $.myAlert({
                            content: res.msg,
                            confirm: function () {
                                location.reload();
                            }
                        });
                    }
                    if (res.code == 1) {
                        $.myAlert({
                            content: res.msg,
                            confirm: function () {
                                $.myLoadingHide();
                            }
                        });
                    }
                }
            });
        }
    });
});


//同意换货
$(document).on("click", ".agree-btn-2", function () {
    var id = $(this).attr("data-id");
    var price = $(this).attr("data-price");
    $.myConfirm({
        content: "确认同意换货？",
        confirm: function () {
            $.myLoading({
                title: "正在提交"
            });
            $.ajax({
                type: "post",
                data: {
                    _csrf: _csrf,
                    order_refund_id: id,
                    type: 2,
                    action: 1,
                },
                dataType: "json",
                success: function (res) {
                    if (res.code == 0) {
                        $.myAlert({
                            content: res.msg,
                            confirm: function () {
                                location.reload();
                            }
                        });
                    }
                    if (res.code == 1) {
                        $.myAlert({
                            content: res.msg,
                            confirm: function () {
                                $.myLoadingHide();
                            }
                        });
                    }
                }
            });

        }
    });
});


//拒绝换货
$(document).on("click", ".disagree-btn-2", function () {
    var id = $(this).attr("data-id");
    var price = $(this).attr("data-price");
    $.myConfirm({
        content: "确认拒绝该换货申请？",
        confirm: function () {
            $.myLoading({
                title: "正在提交"
            });
            $.ajax({
                type: "post",
                data: {
                    _csrf: _csrf,
                    order_refund_id: id,
                    type: 2,
                    action: 2,
                },
                dataType: "json",
                success: function (res) {
                    if (res.code == 0) {
                        $.myAlert({
                            content: res.msg,
                            confirm: function () {
                                location.reload();
                            }
                        });
                    }
                    if (res.code == 1) {
                        $.myAlert({
                            content: res.msg,
                            confirm: function () {
                                $.myLoadingHide();
                            }
                        });
                    }
                }
            });
        }
    });
});

</script>    </div>
</div>

{/block}
